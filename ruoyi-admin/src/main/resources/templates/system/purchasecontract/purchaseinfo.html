<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('修改销售合同列表')" />
    <th:block th:include="include :: datetimepicker-css" />
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-purchasecontract-edit" th:object="${purchasecontract}">
        <input name="id" th:field="*{id}" type="hidden">
        <div class="form-group">
            <label class="col-sm-3 control-label is-required">采购合同号：</label>
            <div class="col-sm-8">
                <input name="purchasecontractid" readonly th:field="*{purchasecontractid}" class="form-control" type="text" required>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">乙方：</label>
            <div class="col-sm-8">
                <input name="partyb" readonly th:field="*{partyb}" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">签订日期：</label>
            <div class="col-sm-8">
                <div class="input-group date">
                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                    <input name="signingtime"  readonly th:value="${#dates.format(purchasecontract.signingtime, 'yyyy-MM-dd')}" class="form-control" placeholder="yyyy-MM-dd" type="text">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">付款方式：</label>
            <div class="col-sm-8">
                <input name="payway" readonly th:field="*{payway}" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">备注：</label>
            <div class="col-sm-8">
                <input name="remarks" readonly th:field="*{purchasesamount}" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">合同金额：</label>
            <div class="col-sm-8">
                <input name="remarks" readonly th:field="*{remarks}" class="form-control" type="text">
            </div>
        </div>


        <div class="form-group">
            <label class="col-sm-3 control-label">所属销售合同号：</label>
            <div class="col-sm-8">
                <input name="contractid" readonly th:field="*{contractid}" class="form-control" type="text">
            </div>
        </div>
    </form>
</div>
<div class="col-sm-12 select-table table-striped">
    <table id="bootstrap-table"></table>
</div>



<div class="col-sm-12 select-table table-striped">
    <table id="bootstrap-table1"></table>
</div>
<th:block th:include="include :: footer" />
<th:block th:include="include :: datetimepicker-js" />
<script th:inline="javascript">
    var purchaseinvoicestatusDatas = [[${@dict.getType('invoice_status')}]];
    var prefix = ctx + "system/salescontract";
    var prefix1 = ctx + "system/purchasedetail";
    var prefix2 = ctx + "system/purchaseinvoice";
    var prefix3 = ctx + "system/child";
    $("#form-salescontract-edit").validate({
        focusCleanup: true
    });

    function submitHandler() {
        if ($.validate.form()) {
            $.operate.save(prefix + "/edit", $('#form-salescontract-edit').serialize());
        }
    }

    $("input[name='signingtime']").datetimepicker({
        format: "yyyy-mm-dd",
        minView: "month",
        autoclose: true
    });


    $(function() {
        var options = {
            url: prefix1 + "/list",
            showSearch: false,
            showRefresh: false,
            showToggle: false,
            showColumns: false,
            detailView: true,
            modalName: "采购订单",
            queryParams : {
                purchasecontractid:$("#purchasecontractid").val()
            },
            onExpandRow : function(index, row, $detail) {
                initChildTable(index, row, $detail);
            },
            columns: [{
                checkbox: true
            },

                {
                    field: 'id',
                    title: 'id',
                    visible: false
                },
                {
                    field: 'productname',
                    title: '商品名称'
                },
                {
                    field: 'supplier',
                    title: '供应商'
                },
                {
                    field: 'price',
                    title: '单价'
                },
                {
                    field: 'unit',
                    title: '单位'
                },
                {
                    field: 'specifications',
                    title: '型号'
                },
                {
                    field: 'purchasecontractid',
                    title: '所属采购合同号'
                },
                {
                    field: 'producttype',
                    title: '商品类型'
                },
                {
                    field: 'productnum',
                    title: '商品数量'
                },
                {
                    field: 'money',
                    title: '金额'
                },
                {
                    field: 'purchaseinvoicestatus',
                    title: '开票状态',
                    formatter: function(value, row, index) {
                        return $.table.selectDictLabel(purchaseinvoicestatusDatas, value);
                    }
                },
                {
                    field: 'createTime',
                    title: '创建时间'
                }
               ]
        };
        $.table.init(options);
    });

    initChildTable = function(index, row1, $detail) {
        var childTable = $detail.html('<table style="table-layout:fixed"></table>').find('table');
        $(childTable).bootstrapTable({
            url: prefix2 + "/list",
            method: 'post',
            detailView: true,
            sidePagination: "server",
            contentType: "application/x-www-form-urlencoded",
            queryParams : {
                purchasedetailid: row1.id
            },
            onExpandRow : function(index, row, $detail) {
                initChildTable1(index, row, $detail);
            },
            columns: [

                {
                    field: 'id',
                    title: 'id',
                    visible: false
                },
                {
                    field: 'purchaseinvoiceid',
                    title: '发票编号'
                },

                {
                    field: 'purchasecontractid',
                    title: '所属采购合同'
                },
                {
                    field: 'buyer',
                    title: '采购方'
                },
                {
                    field: 'money',
                    title: '发票金额'
                },
                {
                    field: 'purchaseinvoicetime',
                    title: '开票时间'
                },
                {
                    field: 'createTime',
                    title: '创建时间'
                },
            ]
        });


        initChildTable1 = function(index, row1, $detail) {
            console.log(row1);
            var childTable = $detail.html('<table style="table-layout:fixed"></table>').find('table');
            $(childTable).bootstrapTable({
                url: prefix3 + "/list",
                method: 'post',
                sidePagination: "server",
                contentType: "application/x-www-form-urlencoded",
                queryParams : {
                    purchasedetailid: row1.purchasedetailid
                },
                columns: [

                    {
                        field: 'id',
                        title: 'id',
                        visible: false
                    },
                    {
                        field: 'productname',
                        title: '商品名称'
                    },
                    {
                        field: 'supplier',
                        title: '供应商'
                    },
                    {
                        field: 'price',
                        title: '单价'
                    },
                    {
                        field: 'unit',
                        title: '单位'
                    },
                    {
                        field: 'specifications',
                        title: '型号'
                    },
                    {
                        field: 'producttype',
                        title: '商品类型'
                    },
                    {
                        field: 'productnum',
                        title: '商品数量'
                    },
                    {
                        field: 'money',
                        title: '金额'
                    },
                    {
                        field: 'createTime',
                        title: '创建时间'
                    },
                   ]
            });
        };
    };

</script>
</body>
</html>